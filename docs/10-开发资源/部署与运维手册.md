# YYC3 AI小语智能成长守护系统 - 部署与运维手册

> 版本: v1.0 | 更新日期: 2024-12-20

---

## 一、系统概述

### 1.1 项目信息

| 项目 | 说明 |
|------|------|
| 项目名称 | YYC3 AI小语智能成长守护系统 |
| 技术栈 | Next.js 16 + React 19 + TypeScript |
| 部署平台 | Vercel |
| 数据库 | Supabase (PostgreSQL) |
| AI服务 | Vercel AI Gateway |

### 1.2 环境要求

| 依赖 | 版本要求 |
|------|----------|
| Node.js | >= 18.17.0 |
| npm/pnpm | >= 8.0 |
| Git | >= 2.0 |

---

## 二、快速部署

### 2.1 Vercel一键部署

1. Fork项目到您的GitHub账号
2. 登录 [Vercel](https://vercel.com)
3. 点击 "New Project"
4. 选择Fork的仓库
5. 配置环境变量(见2.3节)
6. 点击 "Deploy"

### 2.2 本地开发部署

\`\`\`bash
# 克隆项目
git clone https://github.com/YY-Nexus/yyc3-xy-03.git
cd yyc3-xy-03

# 安装依赖
npm install

# 配置环境变量
cp .env.example .env.local
# 编辑 .env.local 填入实际值

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 启动生产服务器
npm run start
\`\`\`

### 2.3 环境变量配置

| 变量名 | 必填 | 说明 |
|--------|------|------|
| `OPENAI_API_KEY` | 是 | OpenAI API密钥 |
| `NEXT_PUBLIC_SUPABASE_URL` | 否 | Supabase项目URL |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | 否 | Supabase匿名密钥 |
| `AZURE_SPEECH_KEY` | 否 | Azure语音服务密钥 |
| `AZURE_SPEECH_REGION` | 否 | Azure语音服务区域 |

---

## 三、数据库配置

### 3.1 Supabase初始化

\`\`\`sql
-- 执行 scripts/database-schema.sql 创建表结构

-- 验证表创建
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public';
\`\`\`

### 3.2 RLS策略配置

\`\`\`sql
-- 启用RLS
ALTER TABLE children ENABLE ROW LEVEL SECURITY;
ALTER TABLE growth_records ENABLE ROW LEVEL SECURITY;
ALTER TABLE assessments ENABLE ROW LEVEL SECURITY;

-- 用户数据隔离策略
CREATE POLICY "Users can manage own children"
  ON children FOR ALL
  USING (parent_id = auth.uid());
\`\`\`

---

## 四、监控与日志

### 4.1 性能监控

系统内置Web Vitals监控，关键指标:

| 指标 | 目标值 | 说明 |
|------|--------|------|
| LCP | <2.5s | 最大内容绘制 |
| FID | <100ms | 首次输入延迟 |
| CLS | <0.1 | 累积布局偏移 |
| TTFB | <800ms | 首字节时间 |

### 4.2 错误监控

\`\`\`typescript
// 错误边界已内置于 app/error.tsx
// 生产环境建议集成Sentry

// Sentry配置示例
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  tracesSampleRate: 0.1,
})
\`\`\`

### 4.3 日志规范

| 级别 | 用途 | 示例 |
|------|------|------|
| INFO | 正常操作 | 用户登录、记录创建 |
| WARN | 潜在问题 | 接口超时、缓存失效 |
| ERROR | 异常错误 | API失败、数据异常 |

---

## 五、常见问题

### 5.1 构建失败

\`\`\`bash
# 清除缓存重新构建
rm -rf .next node_modules
npm install
npm run build
\`\`\`

### 5.2 语音功能不可用

语音功能需要HTTPS环境和用户授权:
- 开发环境使用 localhost (自动HTTPS)
- 生产环境确保域名配置SSL证书
- 检查浏览器麦克风权限

### 5.3 AI响应超时

\`\`\`typescript
// 调整API超时配置
export const config = {
  maxDuration: 60, // 秒
}
\`\`\`

---

## 六、版本更新

### 6.1 更新流程

\`\`\`bash
# 拉取最新代码
git pull origin main

# 安装新依赖
npm install

# 执行数据库迁移(如有)
npm run db:migrate

# 重新部署
npm run build
\`\`\`

### 6.2 回滚操作

Vercel支持一键回滚:
1. 进入项目Dashboard
2. 选择Deployments
3. 找到稳定版本
4. 点击 "Promote to Production"

---

## 七、安全配置

### 7.1 API安全

- 所有API路由已配置CORS
- 敏感操作需要认证Token
- 数据库启用RLS策略

### 7.2 数据安全

- 用户密码使用bcrypt加密
- 敏感数据传输使用HTTPS
- 儿童数据严格隔离

---

## 八、联系支持

| 渠道 | 联系方式 |
|------|----------|
| 技术支持 | support@yyc3.ai |
| 文档反馈 | docs@yyc3.ai |
| 紧急问题 | 400-XXX-XXXX |

---

*文档维护: YYC3运维团队*
