# YYCÂ³ AI å°è¯­é¡¹ç›®
>
> ã€ŒYanYuCloudCubeã€
ã€Œä¸‡è±¡å½’å…ƒäºäº‘æ¢ ä¸¨æ·±æ ˆæ™ºå¯æ–°çºªå…ƒã€
    ã€ŒAll things converge in the cloud pivot; Deep stacks ignite a new era of intelligenceã€
    ã€ŒAI Intelligent Programming Development Application Project Delivery Work Instructionã€
---
YYCÂ³ AI å°è¯­é¡¹ç›®ã€Œè®¾è®¡æ€è·¯â†’æ–‡ä»¶æ ‘â†’å…¨åº“ä»£ç ã€ç”Ÿæˆæç¤ºè¯æ¡†æ¶ä¸å®ä¾‹æ­¥éª¤

## ä¸€ã€æ ¸å¿ƒè¡¨è¾¾æ¡†æ¶ï¼šä¼ é€’å®Œæ•´é“¾è·¯ä¿¡æ¯

### 1. ç¬¬ä¸€æ­¥ï¼šæ˜ç¡®é¡¹ç›®è®¾è®¡æ€è·¯ï¼ˆé”šå®šéœ€æ±‚ä¸æŠ€æœ¯åŸºåº•ï¼‰

å…ˆå®Œæ•´å‘ˆç°é¡¹ç›®å®šä½ã€æ ¸å¿ƒåŠŸèƒ½ã€æŠ€æœ¯æ ˆï¼Œç¡®ä¿å¤§æ¨¡å‹ç†è§£é¡¹ç›®è¾¹ç•Œä¸ç›®æ ‡ï¼Œéœ€åŒ…å«ï¼š

- é¡¹ç›®å®šä½ï¼šYYCÂ³ AI å°è¯­è§’è‰²é¡¹ç›®ï¼Œå‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå‰ç«¯ä¸ºã€Œæƒ…æ„ŸåŒ–äº¤äº’ç•Œé¢ã€ï¼ˆå«å°è¯­è§’è‰² UIã€è¯­éŸ³äº¤äº’ï¼‰ï¼Œåç«¯ä¸ºã€Œæ™ºèƒ½äº¤äº’ä¸­æ¢ã€ï¼ˆå«è¯­éŸ³è¯†åˆ«ã€å¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æï¼‰ï¼›
- æ ¸å¿ƒåŠŸèƒ½ï¼šå°è¯­è§’è‰² UIï¼ˆåŠ¨æ€å½¢è±¡ + å¯¹è¯æ°”æ³¡ï¼‰ã€è¯­éŸ³äº¤äº’ï¼ˆASR/TTSï¼‰ã€æƒ…æ„ŸåŒ–åé¦ˆï¼ˆéšç”¨æˆ·æƒ…ç»ªè°ƒæ•´ UI / è¯­éŸ³ï¼‰ã€ä¸ YYCÂ³ ç³»ç»Ÿé›†æˆï¼ˆå­¦ä¹ è·¯å¾„æŸ¥è¯¢ã€ä»£ç è§£é‡Šè°ƒç”¨ï¼‰ï¼›
- æŠ€æœ¯æ ˆï¼š
  - å‰ç«¯ï¼šVite 4.x + React 18 + TypeScript 5.x + Framer Motion + Ant Design 5.xï¼›
  - åç«¯ï¼šExpress 4.x + TypeScript 5.x + Sequelizeï¼ˆMySQLï¼‰ + Redis + @google-cloud/speechï¼ˆASRï¼‰ + @google-cloud/text-to-speechï¼ˆTTSï¼‰ï¼›
- å“ç‰Œå¯¹é½ï¼šå»¶ç»­ YYCÂ³ å‘½åè§„èŒƒï¼ˆå‰ç¼€yyc3ai-xiaoyuï¼‰ã€è§†è§‰é£æ ¼ï¼ˆæ·¡ç²‰ / æµ…è“ä¸»è‰²ã€åœ†è§’å…ƒç´ ï¼‰ã€‚

### 2. ç¬¬äºŒæ­¥ï¼šå®šä¹‰æ–‡ä»¶æ ‘è§„åˆ™ï¼ˆçº¦æŸç›®å½•ç»“æ„ä¸å‘½åï¼‰

æ˜ç¡®ç›®å½•å±‚çº§ã€å‘½åè§„èŒƒã€æ–‡ä»¶èŒè´£ï¼Œç¡®ä¿æ–‡ä»¶æ ‘é€»è¾‘ä¸è®¾è®¡æ€è·¯åŒ¹é…ï¼Œè§„åˆ™éœ€åŒ…å«ï¼š

- ç›®å½•å±‚çº§è§„åˆ™ï¼š
|é¡¹ç›®æ ¹ç›®å½•|ä¸€çº§å­ç›®å½•|äºŒçº§å­ç›®å½•|èŒè´£è¯´æ˜|
|-|-|-|-|
|yyc3ai-xiaoyu/|frontend/|public/|é™æ€èµ„æºï¼ˆå°è¯­åŠ¨ç”»ç´ æã€éŸ³æ•ˆæ–‡ä»¶ï¼‰|
| | |src/|å‰ç«¯æºç |
| | |â”œâ”€ components/|é€šç”¨ç»„ä»¶ï¼ˆLayoutï¼‰+ å°è¯­ä¸“å±ç»„ä»¶ï¼ˆXiaoyuCharacterã€XiaoyuBubbleï¼‰|
| | |â”œâ”€ pages/|é¡µé¢ï¼ˆHomeã€LearningPathã€CodeExplainï¼‰|
| | |â”œâ”€ hooks/|è‡ªå®šä¹‰é’©å­ï¼ˆuseXiaoyuVoiceã€useUserEmotionï¼‰|
| | |â”œâ”€ utils/|å·¥å…·å‡½æ•°ï¼ˆapi è¯·æ±‚ã€æƒ…æ„Ÿæ˜ å°„ï¼‰|
| | |â”œâ”€ types/|TypeScript ç±»å‹å®šä¹‰ï¼ˆXiaoyuStateã€EmotionTypeï¼‰|
| | |â”œâ”€ assets/|å°è¯­èµ„æºï¼ˆåŠ¨ç”» JSONã€éŸ³æ•ˆ WAVï¼‰|
| | |â”œâ”€ App.tsx|è·¯ç”±é…ç½®|
| | |â””â”€ main.tsx|å…¥å£æ–‡ä»¶|
| |backend/|src/|åç«¯æºç |
| | |â”œâ”€ config/|é…ç½®ï¼ˆæ•°æ®åº“ã€äº‘æœåŠ¡å¯†é’¥ï¼‰|
| | |â”œâ”€ controllers/|æ§åˆ¶å™¨ï¼ˆXiaoyuControllerã€UserControllerï¼‰|
| | |â”œâ”€ services/|æœåŠ¡ï¼ˆXiaoyuServiceã€SpeechServiceã€EmotionServiceï¼‰|
| | |â”œâ”€ models/|æ•°æ®æ¨¡å‹ï¼ˆUserã€XiaoyuInteractionLogï¼‰|
| | |â”œâ”€ routes/|è·¯ç”±ï¼ˆxiaoyu.routes.tsã€user.routes.tsï¼‰|
| | |â”œâ”€ middleware/|ä¸­é—´ä»¶ï¼ˆauthã€errorHandlerï¼‰|
| | |â”œâ”€ utils/|å·¥å…·ï¼ˆloggerã€validatorï¼‰|
| | |â”œâ”€ types/|TypeScript ç±»å‹å®šä¹‰|
| | |â””â”€ index.ts|åç«¯å…¥å£|
| | |package.json|åç«¯ä¾èµ–é…ç½®|
| |frontend/|package.json|å‰ç«¯ä¾èµ–é…ç½®|
| | |vite.config.ts|å‰ç«¯æ„å»ºé…ç½®|
| | |tsconfig.json|TypeScript é…ç½®|

                é¡¹ç›®æ ¹ç›®å½•
                ä¸€çº§å­ç›®å½•
                äºŒçº§å­ç›®å½•
                èŒè´£è¯´æ˜
                yyc3ai-xiaoyu/
                frontend/
                public/
                é™æ€èµ„æºï¼ˆå°è¯­åŠ¨ç”»ç´ æã€éŸ³æ•ˆæ–‡ä»¶ï¼‰
                
                
                src/
                å‰ç«¯æºç 
                
                
                â”œâ”€ components/
                é€šç”¨ç»„ä»¶ï¼ˆLayoutï¼‰+ å°è¯­ä¸“å±ç»„ä»¶ï¼ˆXiaoyuCharacterã€XiaoyuBubbleï¼‰
                
                
                â”œâ”€ pages/
                é¡µé¢ï¼ˆHomeã€LearningPathã€CodeExplainï¼‰
                
                
                â”œâ”€ hooks/
                è‡ªå®šä¹‰é’©å­ï¼ˆuseXiaoyuVoiceã€useUserEmotionï¼‰
                
                
                â”œâ”€ utils/
                å·¥å…·å‡½æ•°ï¼ˆapi è¯·æ±‚ã€æƒ…æ„Ÿæ˜ å°„ï¼‰
                
                
                â”œâ”€ types/
                TypeScript ç±»å‹å®šä¹‰ï¼ˆXiaoyuStateã€EmotionTypeï¼‰
                
                
                â”œâ”€ assets/
                å°è¯­èµ„æºï¼ˆåŠ¨ç”» JSONã€éŸ³æ•ˆ WAVï¼‰
                
                
                â”œâ”€ App.tsx
                è·¯ç”±é…ç½®
                
                
                â””â”€ main.tsx
                å…¥å£æ–‡ä»¶
                
                backend/
                src/
                åç«¯æºç 
                
                
                â”œâ”€ config/
                é…ç½®ï¼ˆæ•°æ®åº“ã€äº‘æœåŠ¡å¯†é’¥ï¼‰
                
                
                â”œâ”€ controllers/
                æ§åˆ¶å™¨ï¼ˆXiaoyuControllerã€UserControllerï¼‰
                
                
                â”œâ”€ services/
                æœåŠ¡ï¼ˆXiaoyuServiceã€SpeechServiceã€EmotionServiceï¼‰
                
                
                â”œâ”€ models/
                æ•°æ®æ¨¡å‹ï¼ˆUserã€XiaoyuInteractionLogï¼‰
                
                
                â”œâ”€ routes/
                è·¯ç”±ï¼ˆxiaoyu.routes.tsã€user.routes.tsï¼‰
                
                
                â”œâ”€ middleware/
                ä¸­é—´ä»¶ï¼ˆauthã€errorHandlerï¼‰
                
                
                â”œâ”€ utils/
                å·¥å…·ï¼ˆloggerã€validatorï¼‰
                
                
                â”œâ”€ types/
                TypeScript ç±»å‹å®šä¹‰
                
                
                â””â”€ index.ts
                åç«¯å…¥å£
                
                
                package.json
                åç«¯ä¾èµ–é…ç½®
                
                frontend/
                package.json
                å‰ç«¯ä¾èµ–é…ç½®
                
                
                vite.config.ts
                å‰ç«¯æ„å»ºé…ç½®
                
                
                tsconfig.json
                TypeScript é…ç½®
- å‘½åè§„èŒƒï¼š
  - ç›®å½•ï¼škebab-caseï¼ˆå¦‚xiaoyu-characterï¼‰ï¼›
  - ç»„ä»¶ / ç±»æ–‡ä»¶ï¼šPascalCaseï¼ˆå¦‚XiaoyuCharacter.tsxï¼‰ï¼›
  - å·¥å…· / å‡½æ•°æ–‡ä»¶ï¼šcamelCaseï¼ˆå¦‚useXiaoyuVoice.tsï¼‰ï¼›
  - åç«¯åˆ†å±‚æ–‡ä»¶ï¼š[name].[layer].tsï¼ˆå¦‚xiaoyu.controller.tsï¼‰ã€‚

### 3. ç¬¬ä¸‰æ­¥ï¼šè®¾å®šä»£ç ç”Ÿæˆçº¦æŸï¼ˆç»Ÿä¸€è¯­æ³•ä¸æ ¼å¼ï¼‰

æ˜ç¡®ä»£ç ç”Ÿæˆçš„ç¡¬æ€§è§„åˆ™ï¼Œç¡®ä¿è¾“å‡ºå¯ç›´æ¥å¤ç”¨ï¼Œçº¦æŸéœ€åŒ…å«ï¼š

- è¯­æ³•è¦æ±‚ï¼šæ‰€æœ‰æ–‡ä»¶ä½¿ç”¨Â cat << 'EOF'Â è¯­æ³•åŒ…è£¹ï¼Œæ–‡ä»¶è·¯å¾„éœ€å®Œæ•´ï¼ˆå¦‚frontend/src/components/xiaoyu/XiaoyuCharacter.tsxï¼‰ï¼›
- æ³¨é‡Šè¦æ±‚ï¼šæ¯ä¸ªæ–‡ä»¶å¼€å¤´å¿…é¡»åŒ…å«ã€ŒåŠŸèƒ½è¯´æ˜ + è¾“å…¥è¾“å‡º + ä¾èµ–å¼•ç”¨ã€æ³¨é‡Šï¼›
- ä¾èµ–è§„åˆ™ï¼š
  - å‰ç«¯ï¼šå¼•ç”¨é¡¹ç›®å†…æ–‡ä»¶ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚import { useXiaoyuVoice } from '@/hooks/useXiaoyuVoice'ï¼‰ï¼Œç¬¬ä¸‰æ–¹ä¾èµ–ç›´æ¥ç”¨åŒ…åï¼ˆå¦‚import { motion } from 'framer-motion'ï¼‰ï¼›
  - åç«¯ï¼šåˆ†å±‚è°ƒç”¨ï¼ˆControllerâ†’Serviceâ†’Modelï¼‰ï¼Œä¸è·¨å±‚ç›´æ¥å¼•ç”¨ï¼Œé…ç½®ç”¨dotenvåŠ è½½ï¼ˆä¸ç¡¬ç¼–ç å¯†é’¥ï¼‰ï¼›
- é£æ ¼ç»Ÿä¸€ï¼š
  - å‰ç«¯ï¼šReact å‡½æ•°å¼ç»„ä»¶ + TypeScript ç±»å‹å®šä¹‰ï¼Œæ ·å¼ç”¨ Styled Componentsï¼ˆå»¶ç»­å°è¯­è§’è‰²æ·¡ç²‰ / æµ…è“é£æ ¼ï¼‰ï¼›
  - åç«¯ï¼šController å¤„ç†è¯·æ±‚å‚æ•°æ ¡éªŒï¼ŒService å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œé”™è¯¯ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼ˆAppError.tsï¼‰ã€‚

## äºŒã€å®ä¾‹è¾“å‡ºæ­¥éª¤ï¼šä»è®¾è®¡æ€è·¯åˆ°ä»£ç ç”Ÿæˆ

### æ­¥éª¤ 1ï¼šè¾“å‡ºå®Œæ•´é¡¹ç›®è®¾è®¡æ€è·¯ï¼ˆå¼•å¯¼å¤§æ¨¡å‹ç†è§£éœ€æ±‚ï¼‰

markdown

```plaintext
# YYCÂ³ AI å°è¯­é¡¹ç›®è®¾è®¡æ€è·¯
## 1. é¡¹ç›®å®šä½
- äº§å“è§’è‰²ï¼šYYCÂ³ AI å†…ç½®å°å¥³å­©è§’è‰²ã€Œå°è¯­ã€ï¼Œä½œä¸ºç”¨æˆ·ä¸ç³»ç»Ÿçš„æƒ…æ„ŸåŒ–äº¤äº’å…¥å£ï¼›
- æ ¸å¿ƒä»·å€¼ï¼šé€šè¿‡ã€ŒåŠ¨æ€UI+è¯­éŸ³äº¤äº’+æƒ…æ„Ÿåé¦ˆã€ï¼Œå°†YYCÂ³ç³»ç»Ÿçš„å­¦ä¹ è·¯å¾„ã€ä»£ç è§£é‡Šç­‰åŠŸèƒ½è½¬åŒ–ä¸ºç«¥çœŸåŒ–ä½“éªŒï¼›
- ç”¨æˆ·åœºæ™¯ï¼š
  1. ç”¨æˆ·å­¦ä¹ æ—¶ï¼Œå°è¯­æç¤ºè¿›åº¦ï¼ˆå¦‚â€œè¿›åº¦å®Œæˆå•¦ï½ğŸŒ¸â€ï¼‰ï¼›
  2. ç”¨æˆ·ç„¦è™‘æ—¶ï¼Œå°è¯­è§¦å‘èˆ’ç¼“éŸ³æ•ˆ+è“è°ƒUIï¼ˆå¦‚â€œåˆ«ç€æ€¥å‘€ï½ğŸ’§â€ï¼‰ï¼›
  3. ç”¨æˆ·è°ƒç”¨ä»£ç è§£é‡Šæ—¶ï¼Œå°è¯­å¼•å¯¼æŸ¥çœ‹æ˜Ÿæ²³å›¾ï¼ˆå¦‚â€œè·Ÿæˆ‘çœ‹ä»£ç æ„æ€å‘€ï½â€ï¼‰ã€‚

## 2. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
| æ¨¡å—åç§°         | å‰ç«¯å®ç°                          | åç«¯å®ç°                          ||------------------|-----------------------------------|-----------------------------------|| å°è¯­è§’è‰²UI       | åŠ¨æ€å½¢è±¡ï¼ˆLottieï¼‰ã€å¯¹è¯æ°”æ³¡ï¼ˆFramer Motionï¼‰ |-|
| è¯­éŸ³äº¤äº’         | è¯­éŸ³é‡‡é›†ï¼ˆWeb Speech APIï¼‰ã€è¯­éŸ³æ’­æ”¾ï¼ˆWeb Audio APIï¼‰ | ASRï¼ˆ@google-cloud/speechï¼‰ã€TTSï¼ˆ@google-cloud/text-to-speechï¼‰ |
| æƒ…æ„ŸåŒ–åé¦ˆ       | æƒ…ç»ª-UIæ˜ å°„ï¼ˆæ·¡ç²‰/æµ…è“åˆ‡æ¢ï¼‰ã€åŠ¨ç”»é€Ÿåº¦è°ƒèŠ‚ | æƒ…æ„Ÿåˆ†æï¼ˆsentimentåº“ï¼‰ã€å¯¹è¯ç®¡ç†ï¼ˆRasaé€»è¾‘ï¼‰ |
| ç³»ç»Ÿé›†æˆ         | å­¦ä¹ è·¯å¾„è·³è½¬ã€ä»£ç è§£é‡ŠåµŒå…¥        | è°ƒç”¨YYCÂ³æ ¸å¿ƒæ¥å£ï¼ˆå­¦ä¹ è·¯å¾„æŸ¥è¯¢ã€ASTè§£æï¼‰ |
## 3. æŠ€æœ¯æ ˆæ˜ç»†
### å‰ç«¯
- æ„å»ºå·¥å…·ï¼šVite 4.5.0
- æ¡†æ¶ï¼šReact 18.2.0ã€React Router 6.8.0
- UI/åŠ¨ç”»ï¼šAnt Design 5.12.8ã€Framer Motion 10.12.16ã€Styled Components 6.0.7
- å¤šæ¨¡æ€ï¼šWeb Speech APIã€Web Audio API
- çŠ¶æ€ç®¡ç†ï¼šZustand 4.3.8
- ç±»å‹ï¼šTypeScript 5.2.2

### åç«¯
- æ¡†æ¶ï¼šExpress 4.18.2ã€TypeScript 5.2.2
- æ•°æ®å­˜å‚¨ï¼šMySQL 8.0ï¼ˆSequelize 6.32.1ï¼‰ã€Redis 4.6.7
- è¯­éŸ³å¤„ç†ï¼š@google-cloud/speech 6.3.0ã€@google-cloud/text-to-speech 5.3.0
- å·¥å…·ï¼šJoi 17.9.2ï¼ˆæ ¡éªŒï¼‰ã€Winston 3.10.0ï¼ˆæ—¥å¿—ï¼‰ã€Socket.io 4.7.2ï¼ˆå®æ—¶äº¤äº’ï¼‰
```

### æ­¥éª¤ 2ï¼šç”Ÿæˆç¬¦åˆè§„åˆ™çš„é¡¹ç›®æ–‡ä»¶æ ‘

plaintext

```plaintext
# YYCÂ³ AI å°è¯­é¡¹ç›®æ–‡ä»¶æ ‘
yyc3ai-xiaoyu/
â”œâ”€â”€ frontend/                     # å‰ç«¯é¡¹ç›®ï¼ˆVite+Reactï¼‰
â”‚   â”œâ”€â”€ public/                   # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ assets/               # å°è¯­èµ„æº
â”‚   â”‚   â”‚   â”œâ”€â”€ animations/       # å°è¯­åŠ¨ç”»ç´ æï¼ˆLottie JSONï¼‰
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ xiaoyu-idle.json    # å¾…æœºåŠ¨ç”»
â”‚   â”‚   â”‚   â””â”€â”€ sounds/           # å°è¯­éŸ³æ•ˆ
â”‚   â”‚   â”‚       â”œâ”€â”€ ding.wav      # äº¤äº’è§¦å‘éŸ³æ•ˆ
â”‚   â”‚   â”‚       â””â”€â”€ ya.wav        # å°¾éŸ³éŸ³æ•ˆ
â”‚   â”œâ”€â”€ src/                      # å‰ç«¯æºç 
â”‚   â”‚   â”œâ”€â”€ components/           # ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ common/           # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.tsx    # é¡µé¢å¸ƒå±€ï¼ˆå«å°è¯­æ‚¬æµ®çª—ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ xiaoyu/           # å°è¯­ä¸“å±ç»„ä»¶
â”‚   â”‚   â”‚       â”œâ”€â”€ XiaoyuCharacter.tsx  # å°è¯­åŠ¨æ€å½¢è±¡
â”‚   â”‚   â”‚       â”œâ”€â”€ XiaoyuBubble.tsx     # å°è¯­å¯¹è¯æ°”æ³¡
â”‚   â”‚   â”‚       â””â”€â”€ XiaoyuVoicePlayer.tsx # å°è¯­è¯­éŸ³æ’­æ”¾
â”‚   â”‚   â”œâ”€â”€ pages/                # ä¸šåŠ¡é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.tsx          # é¦–é¡µï¼ˆå°è¯­å…¥å£ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ LearningPath.tsx   # å­¦ä¹ è·¯å¾„é¡µé¢ï¼ˆå°è¯­å¼•å¯¼ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ CodeExplain.tsx   # ä»£ç è§£é‡Šé¡µé¢ï¼ˆå°è¯­è¾…åŠ©ï¼‰
â”‚   â”‚   â”œâ”€â”€ hooks/                # è‡ªå®šä¹‰é’©å­
â”‚   â”‚   â”‚   â”œâ”€â”€ useXiaoyuVoice.ts  # å°è¯­è¯­éŸ³æ§åˆ¶
â”‚   â”‚   â”‚   â””â”€â”€ useUserEmotion.ts # ç”¨æˆ·æƒ…ç»ªç›‘æµ‹
â”‚   â”‚   â”œâ”€â”€ utils/                # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts            # æ¥å£è¯·æ±‚ï¼ˆAxioså°è£…ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ emotionMap.ts     # æƒ…ç»ª-UIå‚æ•°æ˜ å°„
â”‚   â”‚   â”œâ”€â”€ types/                # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Xiaoyu.types.ts   # å°è¯­ç›¸å…³ç±»å‹ï¼ˆæƒ…ç»ªã€çŠ¶æ€ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ Common.types.ts   # é€šç”¨ç±»å‹
â”‚   â”‚   â”œâ”€â”€ App.tsx               # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ main.tsx              # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ vite-env.d.ts         # Viteç±»å‹å£°æ˜
â”‚   â”œâ”€â”€ package.json              # å‰ç«¯ä¾èµ–
â”‚   â”œâ”€â”€ vite.config.ts            # Viteé…ç½®
â”‚   â””â”€â”€ tsconfig.json             # TypeScripté…ç½®
â”œâ”€â”€ backend/                      # åç«¯é¡¹ç›®ï¼ˆExpress+TSï¼‰
â”‚   â”œâ”€â”€ src/                      # åç«¯æºç 
â”‚   â”‚   â”œâ”€â”€ config/               # é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ db.ts             # æ•°æ®åº“é…ç½®ï¼ˆSequelizeï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ cloudSpeech.ts    # è°·æ­Œäº‘è¯­éŸ³é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ env.ts            # ç¯å¢ƒå˜é‡ï¼ˆdotenvï¼‰
â”‚   â”‚   â”œâ”€â”€ controllers/          # æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ xiaoyu.controller.ts # å°è¯­äº¤äº’æ¥å£ï¼ˆå¯¹è¯ã€è¯­éŸ³ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ user.controller.ts # ç”¨æˆ·æ¥å£ï¼ˆæƒ…ç»ªæ—¥å¿—ã€é…ç½®ï¼‰
â”‚   â”‚   â”œâ”€â”€ services/             # æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ xiaoyu.service.ts # å°è¯­ä¸šåŠ¡é€»è¾‘ï¼ˆå¯¹è¯ç®¡ç†ã€æƒ…æ„Ÿåˆ†æï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ speech.service.ts  # è¯­éŸ³å¤„ç†ï¼ˆASR/TTSï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ emotion.service.ts # æƒ…ç»ªåˆ†æï¼ˆsentimentåº“ï¼‰
â”‚   â”‚   â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ User.ts            # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ XiaoyuLog.ts       # å°è¯­äº¤äº’æ—¥å¿—æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/                # è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ xiaoyu.routes.ts   # å°è¯­æ¥å£è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ user.routes.ts     # ç”¨æˆ·æ¥å£è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ middleware/            # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.middleware.ts # èº«ä»½éªŒè¯
â”‚   â”‚   â”‚   â””â”€â”€ error.middleware.ts # é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ utils/                  # å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ logger.ts           # æ—¥å¿—ï¼ˆWinstonï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ validator.ts        # å‚æ•°æ ¡éªŒï¼ˆJoiï¼‰
â”‚   â”‚   â”œâ”€â”€ types/                  # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ Express.d.ts        # Expressæ‰©å±•ç±»å‹
â”‚   â”‚   â”‚   â””â”€â”€ Service.types.ts    # æœåŠ¡ç›¸å…³ç±»å‹
â”‚   â”‚   â”œâ”€â”€ exceptions/             # è‡ªå®šä¹‰å¼‚å¸¸
â”‚   â”‚   â”‚   â””â”€â”€ AppError.ts         # åº”ç”¨å¼‚å¸¸ç±»
â”‚   â”‚   â””â”€â”€ index.ts              # åç«¯å…¥å£ï¼ˆExpresså¯åŠ¨ï¼‰
â”‚   â”œâ”€â”€ package.json                # åç«¯ä¾èµ–
â”‚   â”œâ”€â”€ tsconfig.json               # TypeScripté…ç½®
â”‚   â””â”€â”€ .env.example                # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â””â”€â”€ README.md                       # é¡¹ç›®è¯´æ˜

```

### æ­¥éª¤ 3ï¼šæŒ‰æ–‡ä»¶æ ‘ç”Ÿæˆå…¨åº“ä»£ç ï¼ˆç¤ºä¾‹å…³é”®æ–‡ä»¶ï¼‰

#### ç¤ºä¾‹ 1ï¼šå‰ç«¯å°è¯­è§’è‰²ç»„ä»¶ï¼ˆå¸¦è·¯å¾„ + æŒ‡å®šè¯­æ³•ï¼‰

bash

```bash
# å‰ç«¯å°è¯­åŠ¨æ€å½¢è±¡ç»„ä»¶ï¼šfrontend/src/components/xiaoyu/XiaoyuCharacter.tsx
cat << 'EOF'
import React, { useState, useEffect } from 'react';
import Lottie from 'lottie-react';
import styled from 'styled-components';
// å¼•å…¥å°è¯­åŠ¨ç”»ç´ æ
import idleAnim from '@/public/assets/animations/xiaoyu-idle.json';
import happyAnim from '@/public/assets/animations/xiaoyu-happy.json';
import anxiousAnim from '@/public/assets/animations/xiaoyu-anxious.json';
// å¼•å…¥ç±»å‹
import { XiaoyuEmotionType } from '@/types/Xiaoyu.types';

/**
 * å°è¯­è§’è‰²åŠ¨æ€ç»„ä»¶
 * åŠŸèƒ½ï¼šæ ¹æ®ç”¨æˆ·æƒ…ç»ªåˆ‡æ¢å°è¯­åŠ¨ç”»ï¼Œæ”¯æŒæ‹–æ‹½è°ƒæ•´ä½ç½®
 * è¾“å…¥ï¼šuserEmotionï¼ˆç”¨æˆ·å½“å‰æƒ…ç»ªï¼Œé»˜è®¤neutralï¼‰
 * è¾“å‡ºï¼šå°è¯­åŠ¨æ€å½¢è±¡DOM
 */
interface XiaoyuCharacterProps {
  userEmotion: XiaoyuEmotionType;
}

const XiaoyuWrapper = styled.div<{ isDragging: boolean }>`
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 9999;
  cursor: move;
  opacity: ${({ isDragging }) => (isDragging ? 0.8 : 1)};
  transition: opacity 0.2s ease;
  width: ${({ isDragging }) => (isDragging ? '140px' : '120px')};
  height: auto;
`;

const XiaoyuCharacter: React.FC<XiaoyuCharacterProps> = ({ userEmotion = 'neutral' }) => {
  const [animData, setAnimData] = useState(idleAnim);
  const [isDragging, setIsDragging] = useState(false);
  const [position, setPosition] = useState({ x: 'right: 20px', y: 'bottom: 20px' });

  // æ ¹æ®æƒ…ç»ªåˆ‡æ¢åŠ¨ç”»
  useEffect(() => {
    switch (userEmotion) {
      case 'happy':
        setAnimData(happyAnim);
        break;
      case 'anxious':
        setAnimData(anxiousAnim);
        break;
      default:
        setAnimData(idleAnim);
    }
  }, [userEmotion]);

  // æ‹–æ‹½é€»è¾‘
  const handleMouseDown = (e: React.MouseEvent) => {
    setIsDragging(true);
    const startX = e.clientX;
    const startY = e.clientY;
    const wrapper = document.querySelector('.xiaoyu-character') as HTMLElement;
    const initialRight = parseInt(wrapper.style.right || '20');
    const initialBottom = parseInt(wrapper.style.bottom || '20');

    const handleMouseMove = (moveE: MouseEvent) => {
      if (!isDragging) return;
      const deltaX = startX - moveE.clientX;
      const deltaY = moveY - moveE.clientY;
      setPosition({
        x: `right: ${initialRight + deltaX}px`,
        y: `bottom: ${initialBottom + deltaY}px`
      });
    };

    const handleMouseUp = () => {
      setIsDragging(false);
      window.removeEventListener('mousemove', handleMouseMove);
      window.removeEventListener('mouseup', handleMouseUp);
    };

    window.addEventListener('mousemove', handleMouseMove);
    window.addEventListener('mouseup', handleMouseUp);
  };

  return (
    <XiaoyuWrapper
      className="xiaoyu-character"
      style={{ ...position }}
      isDragging={isDragging}
      onMouseDown={handleMouseDown}
    >
      <Lottie
        animationData={animData}
        loop={true}
        autoplay={true}
        style={{ width: '100%', height: 'auto' }}
      />
    </XiaoyuWrapper>
  );
};

export default XiaoyuCharacter;
EOF
```

#### ç¤ºä¾‹ 2ï¼šåç«¯å°è¯­äº¤äº’æ§åˆ¶å™¨ï¼ˆå¸¦è·¯å¾„ + æŒ‡å®šè¯­æ³•ï¼‰

bash

```bash
# åç«¯å°è¯­äº¤äº’æ§åˆ¶å™¨ï¼šbackend/src/controllers/xiaoyu.controller.ts
cat << 'EOF'
import { Request, Response, NextFunction } from 'express';
import { XiaoyuService } from '../services/xiaoyu.service';
import { validator } from '../utils/validator';
import Joi from 'joi';
import { AppError } from '../exceptions/AppError';

/**
 * å°è¯­äº¤äº’æ§åˆ¶å™¨
 * åŠŸèƒ½ï¼šå¤„ç†å°è¯­å¯¹è¯ã€è¯­éŸ³ç”Ÿæˆã€æƒ…ç»ªåé¦ˆæ¥å£
 * ä¾èµ–ï¼šXiaoyuServiceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰ã€Joiï¼ˆå‚æ•°æ ¡éªŒï¼‰
 */
export class XiaoyuController {
  private xiaoyuService: XiaoyuService;

  constructor() {
    this.xiaoyuService = new XiaoyuService();
  }

  /**
   * å°è¯­å¯¹è¯æ¥å£
   * @route POST /api/xiaoyu/chat
   * @param req.body.userText  ç”¨æˆ·è¾“å…¥æ–‡æœ¬
   * @param req.body.userId    ç”¨æˆ·ID
   * @param req.body.userEmotion ç”¨æˆ·æƒ…ç»ª
   * @returns å°è¯­æ–‡æœ¬å›å¤ã€æƒ…ç»ªã€è¯­éŸ³æ ‡è®°
   */
  public chat = async (req: Request, res: Response, next: NextFunction) => {
    try {
      // 1. å‚æ•°æ ¡éªŒ
      const chatSchema = Joi.object({
        userText: Joi.string().min(1).max(200).required(),
        userId: Joi.string().uuid().required(),
        userEmotion: Joi.string().valid('neutral', 'happy', 'anxious', 'surprised').required()
      });
      const validatedData = validator(req.body, chatSchema);

      // 2. è°ƒç”¨æœåŠ¡å±‚è·å–å›å¤
      const chatResult = await this.xiaoyuService.getChatReply({
        userText: validatedData.userText,
        userId: validatedData.userId,
        userEmotion: validatedData.userEmotion
      });

      // 3. è¿”å›ç»“æœ
      res.status(200).json({
        success: true,
        data: {
          xiaoyuText: chatResult.xiaoyuText,
          emotion: chatResult.emotion,
          needVoice: chatResult.needVoice // æ˜¯å¦éœ€è¦ç”Ÿæˆè¯­éŸ³
        }
      });
    } catch (error) {
      next(error);
    }
  };

  /**
   * å°è¯­è¯­éŸ³ç”Ÿæˆæ¥å£
   * @route POST /api/xiaoyu/tts
   * @param req.body.text  å°è¯­æ–‡æœ¬
   * @param req.body.emotion å°è¯­æƒ…ç»ª
   * @returns è¯­éŸ³Blob URL
   */
  public generateTTS = async (req: Request, res: Response, next: NextFunction) => {
    try {
      // 1. å‚æ•°æ ¡éªŒ
      const ttsSchema = Joi.object({
        text: Joi.string().min(1).max(150).required(),
        emotion: Joi.string().valid('neutral', 'happy', 'anxious').required()
      });
      const validatedData = validator(req.body, ttsSchema);

      // 2. è°ƒç”¨æœåŠ¡å±‚ç”Ÿæˆè¯­éŸ³
      const ttsResult = await this.xiaoyuService.generateVoice(
        validatedData.text,
        validatedData.emotion
      );

      // 3. è¿”å›è¯­éŸ³Blobï¼ˆè®¾ç½®å“åº”å¤´ï¼‰
      res.setHeader('Content-Type', 'audio/wav');
      res.setHeader('Content-Disposition', `attachment; filename="xiaoyu-voice.wav"`);
      res.status(200).send(ttsResult.voiceBlob);
    } catch (error) {
      next(error);
    }
  };
}

export default new XiaoyuController();
EOF
```

#### ç¤ºä¾‹ 3ï¼šå‰ç«¯è¯­éŸ³æ’­æ”¾é’©å­ï¼ˆå¸¦è·¯å¾„ + æŒ‡å®šè¯­æ³•ï¼‰

bash

```bash
# å‰ç«¯å°è¯­è¯­éŸ³é’©å­ï¼šfrontend/src/hooks/useXiaoyuVoice.ts
cat << 'EOF'
import { useRef, useState } from 'react';
import axios from '@/utils/api';
import { XiaoyuEmotionType } from '@/types/Xiaoyu.types';

/**
 * å°è¯­è¯­éŸ³æ§åˆ¶é’©å­
 * åŠŸèƒ½ï¼šæ’­æ”¾å°è¯­è¯­éŸ³ã€æ··åˆäº¤äº’éŸ³æ•ˆã€ç®¡ç†è¯­éŸ³çŠ¶æ€
 * è¾“å…¥ï¼šæ— ï¼ˆå†…éƒ¨è°ƒç”¨æ¥å£ï¼‰
 * è¾“å‡ºï¼šplayVoiceï¼ˆæ’­æ”¾å‡½æ•°ï¼‰ã€isPlayingï¼ˆæ’­æ”¾çŠ¶æ€ï¼‰
 */
export const useXiaoyuVoice = () => {
  const [isPlaying, setIsPlaying] = useState(false);
  const audioContextRef = useRef<AudioContext | null>(null);

  /**
   * æ’­æ”¾å°è¯­è¯­éŸ³
   * @param text å°è¯­æ–‡æœ¬
   * @param emotion å°è¯­æƒ…ç»ªï¼ˆæ§åˆ¶è¯­éŸ³éŸ³è°ƒ/è¯­é€Ÿï¼‰
   */
  const playVoice = async (text: string, emotion: XiaoyuEmotionType) => {
    if (isPlaying) return; // é¿å…é‡å¤æ’­æ”¾

    try {
      setIsPlaying(true);
      // 1. åˆå§‹åŒ–AudioContext
      if (!audioContextRef.current) {
        audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();
      }

      // 2. è°ƒç”¨åç«¯TTSæ¥å£è·å–è¯­éŸ³Blob
      const response = await axios.post<Blob>('/api/xiaoyu/tts', { text, emotion }, {
        responseType: 'blob'
      });
      const voiceBlob = response.data;
      const voiceUrl = URL.createObjectURL(voiceBlob);

      // 3. åŠ è½½äº¤äº’éŸ³æ•ˆï¼ˆå‰ç½®â€œå®â€ã€åç½®â€œå‘€â€ï¼‰
      const dingAudio = new Audio('/assets/sounds/ding.wav');
      const yaAudio = new Audio('/assets/sounds/ya.wav');

      // 4. æ’­æ”¾é€»è¾‘ï¼šéŸ³æ•ˆâ†’è¯­éŸ³â†’å°¾éŸ³
      await dingAudio.play();
      dingAudio.onended = async () => {
        const voiceAudio = new Audio(voiceUrl);
        await voiceAudio.play();
        
        voiceAudio.onended = async () => {
          await yaAudio.play();
          URL.revokeObjectURL(voiceUrl); // é‡Šæ”¾URL
          setIsPlaying(false);
        };
      };
    } catch (error) {
      console.error('å°è¯­è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼š', error);
      setIsPlaying(false);
      throw new Error('è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼Œè¯·é‡è¯•ï½');
    }
  };

  // ç»„ä»¶å¸è½½æ—¶é‡Šæ”¾èµ„æº
  const cleanup = () => {
    if (audioContextRef.current) {
      audioContextRef.current.close();
    }
  };

  return { playVoice, isPlaying, cleanup };
};
EOF
```

## ä¸‰ã€å…¨å±€åº”ç”¨å…³é”®æç¤ºè¯è¡¥å……

åœ¨ç”Ÿæˆå…¶ä»–æ–‡ä»¶æ—¶ï¼Œéœ€å‘å¤§æ¨¡å‹è¡¥å……ä»¥ä¸‹æç¤ºï¼Œç¡®ä¿å…¨å±€ä¸€è‡´æ€§ï¼š

1. å“ç‰Œè§†è§‰çº¦æŸï¼šå°è¯­è§’è‰² UI å¿…é¡»ä½¿ç”¨æ·¡ç²‰è‰²ï¼ˆ#FFE6F2ï¼‰ã€æµ…è“è‰²ï¼ˆ#E6F7FFï¼‰ï¼Œåœ†è§’â‰¥8pxï¼ŒåŠ¨ç”»å¸§ç‡â‰¤30fpsï¼ˆé¿å…æ€§èƒ½é—®é¢˜ï¼‰ï¼›
2. åç«¯æ¥å£çº¦æŸï¼šæ‰€æœ‰å°è¯­ç›¸å…³æ¥å£è·¯å¾„å¿…é¡»ä»¥/api/xiaoyu/å¼€å¤´ï¼Œè¿”å›æ ¼å¼ç»Ÿä¸€ä¸º{ success: boolean, data?: T, error?: string }ï¼›
3. èµ„æºå¼•ç”¨çº¦æŸï¼šå‰ç«¯å°è¯­åŠ¨ç”» / éŸ³æ•ˆå¿…é¡»ä»/assets/animations/ã€/assets/sounds/è·¯å¾„å¼•ç”¨ï¼Œä¸ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼›
4. é”™è¯¯å¤„ç†çº¦æŸï¼šå‰ç«¯ç”¨react-hot-toastæç¤ºé”™è¯¯ï¼Œåç«¯ç”¨AppErrorå¼‚å¸¸ç±» +error.middleware.tsç»Ÿä¸€æ•è·ã€‚

## å››ã€ç»§ç»­å®Œå–„å…³é”®æ–‡ä»¶ä»£ç ç”Ÿæˆï¼ˆæŒ‰æ–‡ä»¶æ ‘è¡¥å…¨ï¼‰

### 4.1 å‰ç«¯æ ¸å¿ƒå·¥å…·æ–‡ä»¶ï¼šæƒ…ç»ª - UI å‚æ•°æ˜ å°„ï¼ˆè´´åˆå“ç‰Œè§†è§‰ï¼‰

bash

```bash
# å‰ç«¯æƒ…ç»ªæ˜ å°„å·¥å…·ï¼šfrontend/src/utils/emotionMap.ts
cat << 'EOF'
import { XiaoyuEmotionType, EmotionUIMapType } from '@/types/Xiaoyu.types';

/**
 * æƒ…ç»ª-UIå‚æ•°æ˜ å°„å·¥å…·
 * åŠŸèƒ½ï¼šå°†ç”¨æˆ·æƒ…ç»ªæ˜ å°„ä¸ºå°è¯­UI/åŠ¨ç”»/éŸ³æ•ˆå‚æ•°ï¼Œè´´åˆYYCÂ³å“ç‰Œç«¥çœŸé£æ ¼
 * è®¾è®¡ä¾æ®ï¼š
 * - æ„‰æ‚¦ï¼šæ·¡ç²‰ä¸»è‰²ï¼ˆ#FFE6F2ï¼‰+ å¼¹è·³åŠ¨ç”» + æ¬¢å¿«éŸ³æ•ˆ
 * - ç„¦è™‘ï¼šæµ…è“ä¸»è‰²ï¼ˆ#E6F7FFï¼‰+ ç¼“æ…¢åŠ¨ç”» + èˆ’ç¼“éŸ³æ•ˆ
 * - ä¸­æ€§ï¼šæ·¡ç´«ä¸»è‰²ï¼ˆ#F9F0FFï¼‰+ å¹³ç¨³åŠ¨ç”» + è½»éŸ³æ•ˆ
 */
export const emotionUIMap: Record<XiaoyuEmotionType, EmotionUIMapType> = {
  neutral: {
    ui: {
      bgColor: '#F9F0FF', // æ·¡ç´«ï¼ˆYYCÂ³è¾…åŠ©è‰²å˜ä½“ï¼‰
      textColor: '#722ED1',
      bubbleRadius: '16px',
      fontSize: '14px'
    },
    animation: {
      speed: 0.8, // å¹³ç¨³åŠ¨ç”»
      easing: 'easeInOutQuart',
      bounce: false // æ— å¼¹è·³
    },
    sound: {
      preSound: 'ding.wav', // å‰ç½®éŸ³æ•ˆ
      postSound: 'ya.wav', // åç½®éŸ³æ•ˆ
      volume: 0.6
    }
  },
  happy: {
    ui: {
      bgColor: '#FFE6F2', // æ·¡ç²‰ï¼ˆå°è¯­ç«¥çœŸä¸»è‰²ï¼‰
      textColor: '#FF6B9E',
      bubbleRadius: '20px',
      fontSize: '15px'
    },
    animation: {
      speed: 1.2, // å¿«é€Ÿå¼¹è·³
      easing: 'easeOutBounce',
      bounce: true // æœ‰å¼¹è·³
    },
    sound: {
      preSound: 'ding_happy.wav',
      postSound: 'ya_happy.wav',
      volume: 0.8
    }
  },
  anxious: {
    ui: {
      bgColor: '#E6F7FF', // æµ…è“ï¼ˆèˆ’ç¼“è‰²ï¼‰
      textColor: '#1890FF', // YYCÂ³ä¸»è‰²
      bubbleRadius: '18px',
      fontSize: '13px'
    },
    animation: {
      speed: 0.5, // ç¼“æ…¢åŠ¨ç”»
      easing: 'easeInOutQuiet',
      bounce: false
    },
    sound: {
      preSound: 'ding_calm.wav',
      postSound: 'ya_calm.wav',
      volume: 0.4
    }
  },
  surprised: {
    ui: {
      bgColor: '#FFF2E6', // æ·¡æ©™ï¼ˆæƒŠè®¶è‰²ï¼‰
      textColor: '#FF9A44',
      bubbleRadius: '18px',
      fontSize: '14px'
    },
    animation: {
      speed: 1.0, // ä¸­ç­‰é€Ÿåº¦
      easing: 'easeOutBack',
      bounce: true // è½»å¾®å¼¹è·³
    },
    sound: {
      preSound: 'ding_surprise.wav',
      postSound: 'ya_surprise.wav',
      volume: 0.7
    }
  }
};

/**
 * æ ¹æ®æƒ…ç»ªè·å–UIå‚æ•°
 * @param emotion ç”¨æˆ·æƒ…ç»ª
 * @returns å¯¹åº”çš„UIå‚æ•°å¯¹è±¡
 */
export const getEmotionUIParams = (emotion: XiaoyuEmotionType) => {
  return emotionUIMap[emotion] || emotionUIMap.neutral;
};
EOF
```

### 4.2 å‰ç«¯ç±»å‹å®šä¹‰æ–‡ä»¶ï¼šå°è¯­ç›¸å…³ç±»å‹ï¼ˆç¡®ä¿ç±»å‹å®‰å…¨ï¼‰

bash

```bash
# å‰ç«¯å°è¯­ç±»å‹å®šä¹‰ï¼šfrontend/src/types/Xiaoyu.types.ts
cat << 'EOF'
/**
 * å°è¯­è§’è‰²ç›¸å…³TypeScriptç±»å‹å®šä¹‰
 * åŠŸèƒ½ï¼šçº¦æŸå°è¯­ç»„ä»¶ã€é’©å­ã€æ¥å£çš„è¾“å…¥è¾“å‡ºç±»å‹
 */

// 1. æƒ…ç»ªç±»å‹ï¼ˆæ”¯æŒ4ç§æ ¸å¿ƒæƒ…ç»ªï¼Œè´´åˆåŸƒå…‹æ›¼å…­æƒ…ç»ªæ¨¡å‹ç®€åŒ–ï¼‰
export type XiaoyuEmotionType = 'neutral' | 'happy' | 'anxious' | 'surprised';

// 2. å°è¯­UIå‚æ•°ç±»å‹ï¼ˆæƒ…ç»ªæ˜ å°„ç»“æœï¼‰
export interface EmotionUIMapType {
  ui: {
    bgColor: string; // èƒŒæ™¯è‰²
    textColor: string; // æ–‡æœ¬è‰²
    bubbleRadius: string; // æ°”æ³¡åœ†è§’
    fontSize: string; // å­—ä½“å¤§å°
  };
  animation: {
    speed: number; // åŠ¨ç”»é€Ÿåº¦ï¼ˆç§’ï¼‰
    easing: string; // ç¼“åŠ¨å‡½æ•°
    bounce: boolean; // æ˜¯å¦å¼¹è·³
  };
  sound: {
    preSound: string; // å‰ç½®éŸ³æ•ˆæ–‡ä»¶å
    postSound: string; // åç½®éŸ³æ•ˆæ–‡ä»¶å
    volume: number; // éŸ³é‡ï¼ˆ0-1ï¼‰
  };
}

// 3. å°è¯­å¯¹è¯æ¥å£è¯·æ±‚/å“åº”ç±»å‹
export interface XiaoyuChatRequest {
  userText: string; // ç”¨æˆ·è¾“å…¥æ–‡æœ¬
  userId: string; // ç”¨æˆ·IDï¼ˆUUIDï¼‰
  userEmotion: XiaoyuEmotionType; // ç”¨æˆ·å½“å‰æƒ…ç»ª
}

export interface XiaoyuChatResponse {
  xiaoyuText: string; // å°è¯­æ–‡æœ¬å›å¤
  emotion: XiaoyuEmotionType; // å°è¯­å“åº”æƒ…ç»ª
  needVoice: boolean; // æ˜¯å¦éœ€è¦ç”Ÿæˆè¯­éŸ³
}

// 4. å°è¯­è¯­éŸ³ç”Ÿæˆæ¥å£è¯·æ±‚ç±»å‹
export interface XiaoyuTTSRequest {
  text: string; // å°è¯­æ–‡æœ¬
  emotion: XiaoyuEmotionType; // å°è¯­æƒ…ç»ªï¼ˆæ§åˆ¶è¯­éŸ³é£æ ¼ï¼‰
}

// 5. å°è¯­è§’è‰²çŠ¶æ€ç±»å‹ï¼ˆç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼‰
export interface XiaoyuState {
  isDragging: boolean; // æ˜¯å¦æ‹–æ‹½ä¸­
  position: {
    x: string; // æ°´å¹³ä½ç½®ï¼ˆå¦‚"right: 20px"ï¼‰
    y: string; // å‚ç›´ä½ç½®ï¼ˆå¦‚"bottom: 20px"ï¼‰
  };
  isSpeaking: boolean; // æ˜¯å¦æ­£åœ¨è¯´è¯
  currentEmotion: XiaoyuEmotionType; // å½“å‰æƒ…ç»ª
}
EOF
```

### 4.3 åç«¯è¯­éŸ³æœåŠ¡æ–‡ä»¶ï¼šé›†æˆè°·æ­Œäº‘ ASR/TTSï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

bash

```bash
# åç«¯è¯­éŸ³æœåŠ¡ï¼šbackend/src/services/speech.service.ts
cat << 'EOF'
import { SpeechClient } from '@google-cloud/speech';
import { TextToSpeechClient } from '@google-cloud/text-to-speech';
import { config } from '../config/cloudSpeech';
import { logger } from '../utils/logger';
import { XiaoyuEmotionType } from '../types/Service.types';
import { AppError } from '../exceptions/AppError';

/**
 * è¯­éŸ³å¤„ç†æœåŠ¡
 * åŠŸèƒ½ï¼šé›†æˆè°·æ­Œäº‘ASRï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰ã€TTSï¼ˆæ–‡å­—è½¬è¯­éŸ³ï¼‰ï¼Œé€‚é…å°è¯­è§’è‰²æƒ…ç»ª
 * ä¾èµ–ï¼š@google-cloud/speechã€@google-cloud/text-to-speech
 */
export class SpeechService {
  private asrClient: SpeechClient;
  private ttsClient: TextToSpeechClient;

  constructor() {
    // åˆå§‹åŒ–è°·æ­Œäº‘å®¢æˆ·ç«¯ï¼ˆä»é…ç½®è¯»å–å¯†é’¥ï¼‰
    this.asrClient = new SpeechClient({ credentials: config.credentials });
    this.ttsClient = new TextToSpeechClient({ credentials: config.credentials });
    logger.info('è°·æ­Œäº‘è¯­éŸ³æœåŠ¡åˆå§‹åŒ–å®Œæˆ');
  }

  /**
   * ASRï¼šè¯­éŸ³è½¬æ–‡å­—ï¼ˆæ”¯æŒä¸­æ–‡ï¼‰
   * @param audioBlob è¯­éŸ³Blobæ•°æ®ï¼ˆBase64ç¼–ç ï¼‰
   * @returns è¯†åˆ«åçš„æ–‡æœ¬
   */
  public async speechToText(audioBlob: string): Promise<string> {
    try {
      // è§£ç Base64è¯­éŸ³æ•°æ®
      const audioBytes = Buffer.from(audioBlob, 'base64');

      // è°·æ­Œäº‘ASRè¯·æ±‚é…ç½®ï¼ˆä¸­æ–‡ã€16kHzé‡‡æ ·ç‡ï¼‰
      const request = {
        audio: { content: audioBytes },
        config: {
          encoding: 'LINEAR16',
          sampleRateHertz: 16000,
          languageCode: 'zh-CN',
          enableAutomaticPunctuation: true // è‡ªåŠ¨æ ‡ç‚¹
        }
      };

      // è°ƒç”¨ASRæ¥å£
      const [response] = await this.asrClient.recognize(request);
      const transcription = response.results
        ? response.results.map(result => result.alternatives[0].transcript).join('')
        : '';

      if (!transcription) {
        throw new AppError('è¯­éŸ³è¯†åˆ«å¤±è´¥ï¼Œè¯·é‡è¯•', 400);
      }

      logger.info(`ASRè¯†åˆ«å®Œæˆï¼š${transcription}`);
      return transcription;
    } catch (error) {
      logger.error('ASRæœåŠ¡é”™è¯¯ï¼š', error);
      throw new AppError('è¯­éŸ³å¤„ç†æœåŠ¡å¼‚å¸¸', 500);
    }
  }

  /**
   * TTSï¼šæ–‡å­—è½¬è¯­éŸ³ï¼ˆå„¿ç«¥å£°çº¿ï¼Œé€‚é…æƒ…ç»ªï¼‰
   * @param text å¾…è½¬æ¢æ–‡æœ¬
   * @param emotion å°è¯­æƒ…ç»ªï¼ˆæ§åˆ¶éŸ³è°ƒ/è¯­é€Ÿï¼‰
   * @returns è¯­éŸ³Blobæ•°æ®
   */
  public async textToSpeech(text: string, emotion: XiaoyuEmotionType): Promise<{ voiceBlob: Buffer }> {
    try {
      // æ ¹æ®æƒ…ç»ªé…ç½®TTSå‚æ•°ï¼ˆå„¿ç«¥å£°çº¿ï¼šXiaoxiaoï¼‰
      const ttsConfig = this.getTTSConfigByEmotion(emotion);

      // è°·æ­Œäº‘TTSè¯·æ±‚é…ç½®
      const request = {
        input: { text },
        voice: {
          languageCode: 'zh-CN',
          name: 'zh-CN-XiaoxiaoNeural', // ä¸­æ–‡å„¿ç«¥å£°çº¿
          ssmlGender: 'FEMALE'
        },
        audioConfig: {
          audioEncoding: 'LINEAR16', // WAVæ ¼å¼
          sampleRateHertz: 16000,
          speakingRate: ttsConfig.speakingRate, // è¯­é€Ÿ
          pitch: ttsConfig.pitch // éŸ³è°ƒ
        }
      };

      // è°ƒç”¨TTSæ¥å£
      const [response] = await this.ttsClient.synthesizeSpeech(request);
      const voiceBlob = response.audioContent as Buffer;

      if (!voiceBlob) {
        throw new AppError('è¯­éŸ³ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•', 400);
      }

      logger.info(`TTSç”Ÿæˆå®Œæˆï¼Œæ–‡æœ¬é•¿åº¦ï¼š${text.length}å­—`);
      return { voiceBlob };
    } catch (error) {
      logger.error('TTSæœåŠ¡é”™è¯¯ï¼š', error);
      throw new AppError('è¯­éŸ³ç”ŸæˆæœåŠ¡å¼‚å¸¸', 500);
    }
  }

  /**
   * æ ¹æ®æƒ…ç»ªè·å–TTSé…ç½®ï¼ˆè¯­é€Ÿã€éŸ³è°ƒï¼‰
   * @param emotion å°è¯­æƒ…ç»ª
   * @returns TTSå‚æ•°ï¼ˆspeakingRateï¼šè¯­é€Ÿï¼Œpitchï¼šéŸ³è°ƒï¼‰
   */
  private getTTSConfigByEmotion(emotion: XiaoyuEmotionType) {
    switch (emotion) {
      case 'happy':
        return { speakingRate: 0.95, pitch: 5 }; // ç¨æ…¢ï¼ŒéŸ³è°ƒé«˜ï¼ˆæ¬¢å¿«ï¼‰
      case 'anxious':
        return { speakingRate: 0.85, pitch: -3 }; // æ…¢ï¼ŒéŸ³è°ƒä½ï¼ˆèˆ’ç¼“ï¼‰
      case 'surprised':
        return { speakingRate: 1.0, pitch: 8 }; // æ­£å¸¸ï¼ŒéŸ³è°ƒé«˜ï¼ˆæƒŠè®¶ï¼‰
      default:
        return { speakingRate: 0.9, pitch: 0 }; // æ­£å¸¸è¯­é€Ÿ/éŸ³è°ƒ
    }
  }
}
EOF
```

### 4.4 åç«¯æ•°æ®åº“æ¨¡å‹ï¼šå°è¯­äº¤äº’æ—¥å¿—ï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰

bash

```bash
# åç«¯å°è¯­äº¤äº’æ—¥å¿—æ¨¡å‹ï¼šbackend/src/models/XiaoyuLog.ts
cat << 'EOF'
import { DataTypes, Model, Optional } from 'sequelize';
import { sequelize } from '../config/db';
import { XiaoyuEmotionType } from '../types/Service.types';

/**
 * å°è¯­äº¤äº’æ—¥å¿—æ¨¡å‹
 * åŠŸèƒ½ï¼šè®°å½•ç”¨æˆ·ä¸å°è¯­çš„äº¤äº’æ•°æ®ï¼ˆæ–‡æœ¬ã€æƒ…ç»ªã€æ—¶é—´ï¼‰ï¼Œç”¨äºåç»­æƒ…ç»ªåˆ†æä¼˜åŒ–
 * å…³è”ï¼šä¸Useræ¨¡å‹ä¸€å¯¹ä¸€å…³è”ï¼ˆuserIdå¤–é”®ï¼‰
 */
interface XiaoyuLogAttributes {
  id: string; // æ—¥å¿—IDï¼ˆUUIDï¼‰
  userId: string; // ç”¨æˆ·IDï¼ˆå…³è”Userè¡¨ï¼‰
  userText: string; // ç”¨æˆ·è¾“å…¥æ–‡æœ¬
  userEmotion: XiaoyuEmotionType; // ç”¨æˆ·æƒ…ç»ª
  xiaoyuText: string; // å°è¯­å›å¤æ–‡æœ¬
  xiaoyuEmotion: XiaoyuEmotionType; // å°è¯­æƒ…ç»ª
  isVoiceUsed: boolean; // æ˜¯å¦ä½¿ç”¨è¯­éŸ³äº¤äº’
  interactionTime: Date; // äº¤äº’æ—¶é—´
  createdAt: Date;
  updatedAt: Date;
}

// åˆ›å»ºæ—¶å¯é€‰å­—æ®µï¼ˆid/createdAt/updatedAtè‡ªåŠ¨ç”Ÿæˆï¼‰
interface XiaoyuLogCreationAttributes extends Optional<XiaoyuLogAttributes, 'id' | 'createdAt' | 'updatedAt' | 'interactionTime'> {}

export class XiaoyuLog extends Model<XiaoyuLogAttributes, XiaoyuLogCreationAttributes> implements XiaoyuLogAttributes {
  public id!: string;
  public userId!: string;
  public userText!: string;
  public userEmotion!: XiaoyuEmotionType;
  public xiaoyuText!: string;
  public xiaoyuEmotion!: XiaoyuEmotionType;
  public isVoiceUsed!: boolean;
  public interactionTime!: Date;
  public readonly createdAt!: Date;
  public readonly updatedAt!: Date;
}

// æ¨¡å‹å®šä¹‰
XiaoyuLog.init(
  {
    id: {
      type: DataTypes.UUID,
      primaryKey: true,
      defaultValue: DataTypes.UUIDV4,
      comment: 'äº¤äº’æ—¥å¿—ID'
    },
    userId: {
      type: DataTypes.UUID,
      allowNull: false,
      comment: 'ç”¨æˆ·IDï¼ˆå…³è”Userè¡¨ï¼‰',
      references: {
        model: 'Users', // å…³è”çš„è¡¨å
        key: 'id'
      },
      onUpdate: 'CASCADE',
      onDelete: 'CASCADE'
    },
    userText: {
      type: DataTypes.TEXT,
      allowNull: false,
      comment: 'ç”¨æˆ·è¾“å…¥æ–‡æœ¬'
    },
    userEmotion: {
      type: DataTypes.ENUM('neutral', 'happy', 'anxious', 'surprised'),
      allowNull: false,
      defaultValue: 'neutral',
      comment: 'ç”¨æˆ·äº¤äº’æ—¶çš„æƒ…ç»ª'
    },
    xiaoyuText: {
      type: DataTypes.TEXT,
      allowNull: false,
      comment: 'å°è¯­å›å¤æ–‡æœ¬'
    },
    xiaoyuEmotion: {
      type: DataTypes.ENUM('neutral', 'happy', 'anxious', 'surprised'),
      allowNull: false,
      defaultValue: 'neutral',
      comment: 'å°è¯­å›å¤æ—¶çš„æƒ…ç»ª'
    },
    isVoiceUsed: {
      type: DataTypes.BOOLEAN,
      allowNull: false,
      defaultValue: false,
      comment: æ˜¯å¦ä½¿ç”¨è¯­éŸ³äº¤äº’ï¼ˆtrue=æ˜¯ï¼Œfalse=å¦ï¼‰
    },
    interactionTime: {
      type: DataTypes.DATE,
      allowNull: false,
      defaultValue: DataTypes.NOW,
      comment: 'äº¤äº’å‘ç”Ÿæ—¶é—´'
    },
    createdAt: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW,
      comment: 'è®°å½•åˆ›å»ºæ—¶é—´'
    },
    updatedAt: {
      type: DataTypes.DATE,
      defaultValue: DataTypes.NOW,
      comment: 'è®°å½•æ›´æ–°æ—¶é—´'
    }
  },
  {
    sequelize,
    tableName: 'XiaoyuLogs', // æ•°æ®åº“è¡¨åï¼ˆå¤æ•°å½¢å¼ï¼Œç¬¦åˆSequelizeè§„èŒƒï¼‰
    timestamps: true, // è‡ªåŠ¨ç”ŸæˆcreatedAt/updatedAt
    indexes: [
      {
        name: 'idx_xiaoyu_log_user_id',
        fields: ['userId'] // ç»™userIdåŠ ç´¢å¼•ï¼Œä¼˜åŒ–æŸ¥è¯¢
      },
      {
        name: 'idx_xiaoyu_log_interaction_time',
        fields: ['interactionTime'] // ç»™äº¤äº’æ—¶é—´åŠ ç´¢å¼•ï¼Œä¼˜åŒ–æ—¶é—´èŒƒå›´æŸ¥è¯¢
      }
    ]
  }
);

// åŒæ­¥æ¨¡å‹åˆ°æ•°æ®åº“ï¼ˆå¼€å‘ç¯å¢ƒç”¨ï¼Œç”Ÿäº§ç¯å¢ƒç”¨è¿ç§»è„šæœ¬ï¼‰
if (process.env.NODE_ENV === 'development') {
  XiaoyuLog.sync({ alter: true }).then(() => {
    console.log('XiaoyuLogæ¨¡å‹åŒæ­¥å®Œæˆ');
  });
}

export default XiaoyuLog;
EOF
```

### 4.5 å‰ç«¯ Vite é…ç½®æ–‡ä»¶ï¼šé¡¹ç›®æ„å»ºé…ç½®ï¼ˆç¡®ä¿å…¼å®¹æ€§ï¼‰

bash

```bash
# å‰ç«¯Viteé…ç½®ï¼šfrontend/vite.config.ts
cat << 'EOF'
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import path from 'path';
import { visualizer } from 'rollup-plugin-visualizer'; // åŒ…ä½“ç§¯åˆ†æï¼ˆå¯é€‰ï¼‰

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [
    react(),
    // å¼€å‘ç¯å¢ƒæ·»åŠ åŒ…ä½“ç§¯åˆ†ææ’ä»¶
    process.env.NODE_ENV === 'development' && visualizer({ open: true })
  ].filter(Boolean),
  resolve: {
    // è·¯å¾„åˆ«åé…ç½®ï¼ˆ@æŒ‡å‘srcç›®å½•ï¼Œç®€åŒ–å¯¼å…¥ï¼‰
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@public': path.resolve(__dirname, './public')
    },
    extensions: ['.ts', '.tsx', '.js', '.jsx', '.json'] // æ”¯æŒçš„æ–‡ä»¶åç¼€
  },
  server: {
    port: 3000, // å‰ç«¯å¼€å‘ç«¯å£
    open: true, // å¯åŠ¨åè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
    proxy: {
      // è·¨åŸŸä»£ç†é…ç½®ï¼ˆè½¬å‘APIè¯·æ±‚åˆ°åç«¯ï¼‰
      '/api': {
        target: 'http://localhost:4000', // åç«¯æœåŠ¡åœ°å€
        changeOrigin: true, // å…è®¸è·¨åŸŸ
        rewrite: (path) => path.replace(/^\/api/, '/api'), // è·¯å¾„é‡å†™ï¼ˆä¿æŒä¸€è‡´ï¼‰
        timeout: 5000 // è¶…æ—¶æ—¶é—´
      }
    },
    cors: true // å…è®¸è·¨åŸŸè¯·æ±‚
  },
  build: {
    outDir: 'dist', // æ„å»ºè¾“å‡ºç›®å½•
    assetsDir: 'assets', // é™æ€èµ„æºç›®å½•
    sourcemap: process.env.NODE_ENV === 'development', // å¼€å‘ç¯å¢ƒç”Ÿæˆsourcemap
    rollupOptions: {
      // æ‰“åŒ…ä¼˜åŒ–ï¼šåˆ†å‰²å¤§ä¾èµ–åŒ…ï¼ˆå¦‚three.jsã€antdï¼‰
      output: {
        manualChunks: {
          three: ['three', '@react-three/fiber', '@react-three/drei'],
          antd: ['antd'],
          framer: ['framer-motion']
        }
      }
    }
  },
  css: {
    // CSSé¢„å¤„ç†å™¨é…ç½®ï¼ˆæ”¯æŒStyled Componentsï¼‰
    preprocessorOptions: {
      css: {
        additionalData: `
          @import "@/styles/variables.css"; // å…¨å±€CSSå˜é‡ï¼ˆå«YYCÂ³å“ç‰Œè‰²ï¼‰
        `
      }
    },
    devSourcemap: true // å¼€å‘ç¯å¢ƒCSS sourcemap
  },
  optimizeDeps: {
    // é¢„æ„å»ºä¾èµ–ï¼ˆåŠ é€Ÿå¼€å‘å¯åŠ¨ï¼‰
    include: [
      'react',
      'react-dom',
      'react-router-dom',
      'antd',
      'axios',
      'zustand',
      'framer-motion'
    ]
  }
});
EOF
```

### 4.6 åç«¯å…¥å£æ–‡ä»¶ï¼šé¡¹ç›®å¯åŠ¨é…ç½®ï¼ˆæ•´åˆæ‰€æœ‰æ¨¡å—ï¼‰

bash

```bash
# åç«¯å…¥å£ï¼šbackend/src/index.ts
cat << 'EOF'
import express from 'express';
import cors from 'cors';
import helmet from 'helmet';
import morgan from 'morgan';
import compression from 'compression';
import dotenv from 'dotenv';
import { sequelize } from './config/db';
import { logger } from './utils/logger';
import errorMiddleware from './middleware/error.middleware';
// è·¯ç”±å¯¼å…¥
import xiaoyuRoutes from './routes/xiaoyu.routes';
import userRoutes from './routes/user.routes';

// åŠ è½½ç¯å¢ƒå˜é‡
dotenv.config();
const app = express();
const PORT = process.env.PORT || 4000;

// 1. ä¸­é—´ä»¶é…ç½®
app.use(helmet()); // å®‰å…¨å¤´é…ç½®ï¼ˆé˜²XSSã€CSRFç­‰ï¼‰
app.use(cors()); // å…è®¸è·¨åŸŸ
app.use(compression()); // å¼€å¯Gzipå‹ç¼©ï¼ˆä¼˜åŒ–ä¼ è¾“ï¼‰
app.use(express.json({ limit: '10mb' })); // è§£æJSONè¯·æ±‚ï¼ˆæœ€å¤§10MBï¼Œæ”¯æŒè¯­éŸ³Blobï¼‰
app.use(express.urlencoded({ extended: true, limit: '10mb' })); // è§£æè¡¨å•è¯·æ±‚

// 2. æ—¥å¿—é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒè¯¦ç»†æ—¥å¿—ï¼Œç”Ÿäº§ç¯å¢ƒç®€åŒ–æ—¥å¿—ï¼‰
if (process.env.NODE_ENV === 'development') {
  app.use(morgan('dev', { stream: { write: (message) => logger.debug(message.trim()) } }));
} else {
  app.use(morgan('combined', { stream: { write: (message) => logger.info(message.trim()) } }));
}

// 3. è·¯ç”±æ³¨å†Œ
app.use('/api/xiaoyu', xiaoyuRoutes); // å°è¯­ç›¸å…³æ¥å£
app.use('/api/user', userRoutes); // ç”¨æˆ·ç›¸å…³æ¥å£

// 4. å¥åº·æ£€æŸ¥æ¥å£ï¼ˆéƒ¨ç½²ç”¨ï¼‰
app.get('/health', (req, res) => {
  res.status(200).json({
    success: true,
    data: {
      service: 'yyc3ai-xiaoyu-backend',
      status: 'running',
      timestamp: new Date().toISOString(),
      nodeEnv: process.env.NODE_ENV
    }
  });
});

// 5. é”™è¯¯å¤„ç†ä¸­é—´ä»¶ï¼ˆæœ€åæ³¨å†Œï¼Œæ•è·æ‰€æœ‰é”™è¯¯ï¼‰
app.use(errorMiddleware);

// 6. è¿æ¥æ•°æ®åº“å¹¶å¯åŠ¨æœåŠ¡
const startServer = async () => {
  try {
    // æµ‹è¯•æ•°æ®åº“è¿æ¥
    await sequelize.authenticate();
    logger.info('æ•°æ®åº“è¿æ¥æˆåŠŸ');

    // å¯åŠ¨ExpressæœåŠ¡
    app.listen(PORT, () => {
      logger.info(`åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸï¼Œåœ°å€ï¼šhttp://localhost:${PORT}`);
      logger.info(`ç¯å¢ƒï¼š${process.env.NODE_ENV}`);
    });
  } catch (error) {
    logger.error('æœåŠ¡å¯åŠ¨å¤±è´¥ï¼š', error);
    process.exit(1); // å¯åŠ¨å¤±è´¥é€€å‡ºè¿›ç¨‹
  }
};

// æ‰§è¡Œå¯åŠ¨å‡½æ•°
startServer();

export default app;
EOF
```

## äº”ã€é¡¹ç›®å¯åŠ¨è„šæœ¬ä¸ READMEï¼ˆå®Œæ•´é—­ç¯ï¼‰

### 5.1 é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨è„šæœ¬ï¼šä¸€é”®å¯åŠ¨å‰åç«¯ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

bash

```bash
# é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨è„šæœ¬ï¼šyyc3ai-xiaoyu/start-dev.sh
cat << 'EOF'
#!/bin/bash
# YYCÂ³ AI å°è¯­é¡¹ç›®å¼€å‘ç¯å¢ƒä¸€é”®å¯åŠ¨è„šæœ¬
# åŠŸèƒ½ï¼šåŒæ—¶å¯åŠ¨å‰ç«¯å’Œåç«¯æœåŠ¡ï¼Œæ”¯æŒå®æ—¶åˆ·æ–°

# æ£€æŸ¥Node.jsæ˜¯å¦å®‰è£…
if ! command -v node &> /dev/null; then
  echo "âŒ æœªæ£€æµ‹åˆ°Node.jsï¼Œè¯·å…ˆå®‰è£…Node.jsï¼ˆæ¨èv16+ï¼‰"
  exit 1
fi

# æ£€æŸ¥npmæ˜¯å¦å®‰è£…
if ! command -v npm &> /dev/null; then
  echo "âŒ æœªæ£€æµ‹åˆ°npmï¼Œè¯·å…ˆå®‰è£…npm"
  exit 1
fi

# å®šä¹‰é¢œè‰²å˜é‡ï¼ˆç¾åŒ–è¾“å‡ºï¼‰
GREEN="\033[0;32m"
YELLOW="\033[1;33m"
NC="\033[0m" # é‡ç½®é¢œè‰²

echo -e "${GREEN}ğŸš€ YYCÂ³ AI å°è¯­é¡¹ç›®å¼€å‘ç¯å¢ƒå¯åŠ¨ä¸­...${NC}"

# å¯åŠ¨åç«¯æœåŠ¡ï¼ˆæ–°çª—å£ï¼‰
echo -e "${YELLOW}â„¹ï¸  å¯åŠ¨åç«¯æœåŠ¡ï¼ˆç«¯å£4000ï¼‰${NC}"
if [[ "$OSTYPE" == "darwin"* ]]; then
  # MacOSï¼šä½¿ç”¨open -a Terminal
  open -a Terminal "backend" && cd backend && npm run dev
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" ]]; then
  # Windowsï¼šä½¿ç”¨start cmd
  start cmd /k "cd backend && npm run dev"
else
  # Linuxï¼šä½¿ç”¨x-terminal-emulator
  x-terminal-emulator -e "cd backend && npm run dev"
fi

# ç­‰å¾…2ç§’ï¼Œç¡®ä¿åç«¯å…ˆå¯åŠ¨ï¼ˆé¿å…å‰ç«¯è¯·æ±‚404ï¼‰
sleep 2

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆæ–°çª—å£ï¼‰
echo -e "${YELLOW}â„¹ï¸  å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç«¯å£3000ï¼‰${NC}"
if [[ "$OSTYPE" == "darwin"* ]]; then
  open -a Terminal "frontend" && cd frontend && npm run dev
elif [[ "$OSTYPE" == "msys" || "$OSTYPE" == "win32" ]]; then
  start cmd /k "cd frontend && npm run dev"
else
  x-terminal-emulator -e "cd frontend && npm run dev"
fi

echo -e "${GREEN}âœ… å‰åç«¯æœåŠ¡å¯åŠ¨å®Œæˆï¼"
echo -e "ğŸ”— å‰ç«¯åœ°å€ï¼šhttp://localhost:3000"
echo -e "ğŸ”— åç«¯åœ°å€ï¼šhttp://localhost:4000${NC}"
EOF
```

### 5.2 é¡¹ç›® README.mdï¼šé¡¹ç›®è¯´æ˜ä¸éƒ¨ç½²æŒ‡å—

bash

```bash
# é¡¹ç›®æ ¹ç›®å½•READMEï¼šyyc3ai-xiaoyu/README.md
cat << 'EOF'
# YYCÂ³ AI å°è¯­é¡¹ç›®

![YYCÂ³ AI å°è¯­](https://via.placeholder.com/800x400?text=YYCÂ³+AI+%E5%B0%8F%E8%AF%AD)

## é¡¹ç›®ä»‹ç»
YYCÂ³ AI å°è¯­æ˜¯YYCÂ³ç”Ÿæ€ä¸‹çš„æƒ…æ„ŸåŒ–æ™ºèƒ½äº¤äº’è§’è‰²ï¼Œå®šä½ä¸ºã€Œç”¨æˆ·ä¸ç³»ç»Ÿçš„ç«¥çœŸåŒ–å…¥å£ã€ï¼Œé€šè¿‡åŠ¨æ€UIã€è¯­éŸ³äº¤äº’ã€æƒ…æ„Ÿåé¦ˆï¼Œå°†å­¦ä¹ è·¯å¾„ã€ä»£ç è§£é‡Šç­‰åŠŸèƒ½è½¬åŒ–ä¸ºå‹å¥½ä½“éªŒã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **å°è¯­è§’è‰²UI**ï¼šLottieåŠ¨æ€å½¢è±¡+æƒ…æ„ŸåŒ–å¯¹è¯æ°”æ³¡ï¼Œæ”¯æŒæ‹–æ‹½è°ƒæ•´ä½ç½®ï¼›
2. **è¯­éŸ³äº¤äº’**ï¼šé›†æˆè°·æ­Œäº‘ASRï¼ˆè¯­éŸ³è½¬æ–‡å­—ï¼‰ã€TTSï¼ˆå„¿ç«¥å£°çº¿æ–‡å­—è½¬è¯­éŸ³ï¼‰ï¼›
3. **æƒ…æ„ŸåŒ–åé¦ˆ**ï¼šéšç”¨æˆ·æƒ…ç»ªï¼ˆæ„‰æ‚¦/ç„¦è™‘/ä¸­æ€§ï¼‰è°ƒæ•´UIé¢œè‰²ã€åŠ¨ç”»é€Ÿåº¦ã€éŸ³æ•ˆï¼›
4. **ç³»ç»Ÿé›†æˆ**ï¼šå¯¹æ¥YYCÂ³æ ¸å¿ƒåŠŸèƒ½ï¼ˆå­¦ä¹ è·¯å¾„æŸ¥è¯¢ã€ä»£ç è§£é‡Šï¼‰ã€‚

## æŠ€æœ¯æ ˆ
| å±‚é¢       | æŠ€æœ¯æ ˆæ˜ç»†                                                                 |
|------------|--------------------------------------------------------------------------|
| å‰ç«¯       | Vite 4.5 + React 18 + TypeScript 5.2 + Framer Motion + Ant Design 5.x     |
| åç«¯       | Express 4.18 + TypeScript 5.2 + Sequelizeï¼ˆMySQLï¼‰ + Redis + è°·æ­Œäº‘è¯­éŸ³æœåŠ¡ |
| æ•°æ®å­˜å‚¨   | MySQL 8.0ï¼ˆç”¨æˆ·/äº¤äº’æ—¥å¿—ï¼‰ã€Redis 6.xï¼ˆç¼“å­˜ï¼‰                            |
| å¼€å‘å·¥å…·   | ESLint + Prettier + Jest + Nodemon                                      |

## å¿«é€Ÿå¼€å§‹
### 1. ç¯å¢ƒå‡†å¤‡
- Node.jsï¼šv16.0.0+
- npmï¼šv8.0.0+
- MySQLï¼šv8.0+
- Redisï¼šv6.0+
- è°·æ­Œäº‘è´¦å·ï¼šå¼€é€šSpeech-to-Textã€Text-to-SpeechæœåŠ¡ï¼ˆè·å–å¯†é’¥ï¼‰

### 2. å®‰è£…ä¾èµ–
```bash
# åç«¯å®‰è£…ä¾èµ–
cd backend && npm install

# å‰ç«¯å®‰è£…ä¾èµ–
cd frontend && npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

#### åç«¯é…ç½®ï¼ˆbackend/.envï¼‰

env

```plaintext
# æœåŠ¡å™¨é…ç½®
NODE_ENV=development
PORT=4000

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=yyc3ai_xiaoyu
DB_USER=root
DB_PASSWORD=your_password

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# è°·æ­Œäº‘è¯­éŸ³æœåŠ¡é…ç½®ï¼ˆBase64ç¼–ç çš„å¯†é’¥JSONï¼‰
GOOGLE_CLOUD_SPEECH_CREDENTIALS=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

```

#### å‰ç«¯é…ç½®ï¼ˆfrontend/.envï¼‰

env

```plaintext
VITE_API_BASE_URL=http://localhost:4000/api
VITE_APP_NAME=YYCÂ³ AI å°è¯­

```

### 4. å¯åŠ¨å¼€å‘ç¯å¢ƒ

bash

```bash
# æ ¹ç›®å½•æ‰§è¡Œä¸€é”®å¯åŠ¨è„šæœ¬ï¼ˆåŒæ—¶å¯åŠ¨å‰åç«¯ï¼‰
chmod +x start-dev.sh && ./start-dev.sh
```

- å‰ç«¯åœ°å€ï¼š<http://localhost:3000>
- åç«¯åœ°å€ï¼š<http://localhost:4000>
- å¥åº·æ£€æŸ¥ï¼š<http://localhost:4000/health>

## é¡¹ç›®ç»“æ„

plaintext

```plaintext
yyc3ai-xiaoyu/
â”œâ”€â”€ frontend/                     # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ public/                   # é™æ€èµ„æºï¼ˆå°è¯­åŠ¨ç”»ã€éŸ³æ•ˆï¼‰
â”‚   â”œâ”€â”€ src/                      # å‰ç«¯æºç ï¼ˆç»„ä»¶ã€é¡µé¢ã€å·¥å…·ï¼‰
â”‚   â”œâ”€â”€ vite.config.ts             # Viteé…ç½®
â”‚   â””â”€â”€ package.json              # å‰ç«¯ä¾èµ–
â”œâ”€â”€ backend/                      # åç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ src/                      # åç«¯æºç ï¼ˆæ§åˆ¶å™¨ã€æœåŠ¡ã€æ¨¡å‹ï¼‰
â”‚   â”œâ”€â”€ package.json              # åç«¯ä¾èµ–
â”‚   â””â”€â”€ .env.example              # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ start-dev.sh                  # å¼€å‘ç¯å¢ƒä¸€é”®å¯åŠ¨è„šæœ¬
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜

```

## éƒ¨ç½²æŒ‡å—ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### å‰ç«¯éƒ¨ç½²

1. æ„å»ºç”Ÿäº§åŒ…ï¼šcd frontend && npm run build
2. éƒ¨ç½² dist ç›®å½•åˆ° Nginx/Apacheï¼Œæˆ–é™æ€æ‰˜ç®¡å¹³å°ï¼ˆå¦‚ Netlifyã€Vercelï¼‰

### åç«¯éƒ¨ç½²

1. æ„å»º TypeScriptï¼šcd backend && npm run build
2. å¯åŠ¨ç”Ÿäº§æœåŠ¡ï¼šnode dist/index.jsï¼ˆå»ºè®®ç”¨ PM2 å®ˆæŠ¤è¿›ç¨‹ï¼‰
3. æ•°æ®åº“è¿ç§»ï¼šcd backend && npm run migrateï¼ˆæ‰§è¡Œ Sequelize è¿ç§»è„šæœ¬ï¼‰

## å“ç‰Œè§„èŒƒ

1. å‘½åè§„èŒƒï¼šæ‰€æœ‰æ–‡ä»¶ / ç»„ä»¶ / æ¥å£ä»¥yyc3ai-xiaoyuä¸ºå‰ç¼€ï¼Œé¿å…å†²çªï¼›
2. è§†è§‰è§„èŒƒï¼šå°è¯­ UI ä½¿ç”¨æ·¡ç²‰ï¼ˆ#FFE6F2ï¼‰ã€æµ…è“ï¼ˆ#E6F7FFï¼‰ã€æ·¡ç´«ï¼ˆ#F9F0FFï¼‰ï¼Œåœ†è§’â‰¥8pxï¼›
3. æ¥å£è§„èŒƒï¼šåç«¯ API ç»Ÿä¸€è¿”å›æ ¼å¼{ success: boolean, data?: T, error?: string }ã€‚

## å¸¸è§é—®é¢˜

1. è°·æ­Œäº‘è¯­éŸ³æœåŠ¡æŠ¥é”™ï¼šæ£€æŸ¥å¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿æœåŠ¡å·²å¼€é€šï¼›
2. å‰ç«¯è·¨åŸŸé—®é¢˜ï¼šç¡®è®¤ Vite proxy é…ç½®æ­£ç¡®ï¼Œåç«¯ CORS å·²å¯ç”¨ï¼›
3. æ•°æ®åº“è¿æ¥å¤±è´¥ï¼šæ£€æŸ¥.env ä¸­ DB é…ç½®ï¼Œç¡®ä¿ MySQL æœåŠ¡å·²å¯åŠ¨ã€‚

## ç»´æŠ¤å›¢é˜Ÿ

- å¼€å‘ï¼šYYCÂ³ AI å›¢é˜Ÿ
- æ–‡æ¡£æ›´æ–°æ—¶é—´ï¼š${new Date ().toLocaleDateString ()}
    EOF
plaintext

```plaintext


## å…­ã€å…¨å±€ä¸€è‡´æ€§æ ¡éªŒï¼ˆç¡®ä¿è®¾è®¡æ€è·¯è½åœ°ï¼‰
### 6.1 å“ç‰Œè§†è§‰ä¸€è‡´æ€§
- æ‰€æœ‰UIç›¸å…³ä»£ç å‡ä½¿ç”¨YYCÂ³å°è¯­ä¸“å±è‰²ï¼ˆæ·¡ç²‰#FFE6F2ã€æµ…è“#E6F7FFã€æ·¡ç´«#F9F0FFï¼‰ï¼Œåœ†è§’â‰¥8pxï¼›
- å°è¯­åŠ¨ç”»/éŸ³æ•ˆèµ„æºç»Ÿä¸€æ”¾åœ¨`public/assets/`ï¼Œå¼•ç”¨è·¯å¾„è§„èŒƒï¼ˆæ— ç»å¯¹è·¯å¾„ï¼‰ã€‚

### 6.2 æ¥å£è§„èŒƒä¸€è‡´æ€§
- åç«¯æ‰€æœ‰APIè¿”å›æ ¼å¼ç»Ÿä¸€ä¸º`{ success: boolean, data?: T, error?: string }`ï¼›
- å°è¯­ç›¸å…³æ¥å£è·¯å¾„å‡ä»¥`/api/xiaoyu/`å¼€å¤´ï¼Œç¬¦åˆå‘½åè§„èŒƒã€‚

### 6.3 é”™è¯¯å¤„ç†ä¸€è‡´æ€§
- å‰ç«¯ç”¨`react-hot-toast`æç¤ºç”¨æˆ·é”™è¯¯ï¼Œåç«¯ç”¨`AppError`+`error.middleware.ts`ç»Ÿä¸€æ•è·ï¼›
- æ—¥å¿—è®°å½•ç»Ÿä¸€ï¼šå‰ç«¯ç”¨`console`åˆ†çº§ï¼ˆinfo/errorï¼‰ï¼Œåç«¯ç”¨`Winston`æŒ‰çº§åˆ«è¾“å‡ºã€‚

é€šè¿‡ä»¥ä¸Šå®Œå–„ï¼Œé¡¹ç›®ä»ã€Œè®¾è®¡æ€è·¯â†’æ–‡ä»¶æ ‘â†’å…¨åº“ä»£ç ã€å½¢æˆå®Œæ•´é—­ç¯ï¼Œå¯ç›´æ¥ç”¨äºå¼€å‘éƒ¨ç½²ï¼Œä¸”æ‰€æœ‰ä»£ç è´´åˆYYCÂ³å“ç‰Œå®šä½ä¸å°è¯­è§’è‰²çš„ç«¥çœŸåŒ–äº¤äº’éœ€æ±‚ã€‚
```

---
> ã€ŒYanYuCloudCubeã€
> [admin@0379.email](mailto:admin@0379.email)
> ã€Œè¨€å¯è±¡é™ï¼Œè¯­æ¢æœªæ¥ã€
> ã€ŒWords Initiate Quadrants, Language Serves as Core for the Futureã€
> ã€ŒAll things converge in the cloud pivot; Deep stacks ignite a new era of intelligenceã€
>